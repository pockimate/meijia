# 💳 Payment System Testing Guide

## Quick Start

1. **访问网站**: http://localhost:3000
2. **添加商品到购物车**
3. **进入结账页面**: `/checkout`
4. **测试支付功能**

## Test Scenarios

### 1. 信用卡支付测试

#### 测试卡号（任何格式正确的卡号都可以）
```
Visa:       4111 1111 1111 1111
Mastercard: 5555 5555 5555 4444
Amex:       3782 822463 10005
Discover:   6011 1111 1111 1117
```

#### 测试步骤
1. 选择 "Card" 支付方式
2. 输入卡号（会自动格式化）
3. 输入持卡人姓名（任意）
4. 输入过期日期（格式：MM/YY，必须是未来日期）
5. 输入 CVV（3-4位数字）
6. 可选：勾选"保存卡片"
7. 点击"Complete Order"

#### 预期结果
- ✅ 卡号自动添加空格
- ✅ 检测到卡片品牌（Visa/Mastercard等）
- ✅ 实时验证显示
- ✅ 2秒处理延迟
- ✅ 95%成功率，5%随机失败（用于测试错误处理）
- ✅ 成功后跳转到订单成功页面

### 2. 保存卡片功能测试

#### 测试步骤
1. 在卡片表单中勾选"Save card for future purchases"
2. 完成支付
3. 返回结账页面
4. 查看"Saved Cards"部分

#### 预期结果
- ✅ 卡片显示在已保存列表
- ✅ 只显示后4位数字
- ✅ 显示卡片品牌和过期日期
- ✅ 第一张卡自动设为默认
- ✅ 可以删除保存的卡片

### 3. 使用已保存卡片测试

#### 测试步骤
1. 点击已保存的卡片
2. 卡片信息自动填充
3. 只需输入 CVV
4. 完成支付

#### 预期结果
- ✅ 卡片被选中（高亮显示）
- ✅ 卡号和过期日期自动填充
- ✅ CVV 需要重新输入（安全考虑）
- ✅ 支付成功

### 4. PayPal 支付测试

#### 测试步骤
1. 选择 "PayPal" 支付方式
2. 查看提示信息
3. 点击"Complete Order"

#### 预期结果
- ✅ 显示 PayPal 重定向提示
- ✅ 模拟支付处理（1秒延迟）
- ✅ 支付成功

### 5. Apple Pay 测试

#### 测试步骤
1. 选择 "Apple Pay" 支付方式
2. 查看提示信息
3. 点击"Complete Order"

#### 预期结果
- ✅ 显示 Apple Pay 提示
- ✅ 模拟一键支付
- ✅ 支付成功

### 6. Google Pay 测试

#### 测试步骤
1. 选择 "Google Pay" 支付方式
2. 查看提示信息
3. 点击"Complete Order"

#### 预期结果
- ✅ 显示 Google Pay 提示
- ✅ 模拟快速结账
- ✅ 支付成功

### 7. 验证错误测试

#### 无效卡号
```
输入: 1234
预期: "Invalid card number" 错误提示
```

#### 过期日期
```
输入: 01/20 (已过期)
预期: "Invalid date" 错误提示
```

#### 无效 CVV
```
输入: 12 (少于3位)
预期: "Invalid CVV" 错误提示
```

#### 空字段
```
预期: 提交按钮禁用
```

### 8. 支付失败测试

由于有5%的随机失败率，多次尝试支付可能会遇到失败：

#### 预期行为
- ❌ 显示错误消息："Payment declined. Please try another card."
- ❌ 红色错误框显示
- ❌ 表单保持填充状态
- ❌ 可以重试支付

### 9. 移动端测试

#### 测试设备
- iPhone (Safari)
- Android (Chrome)
- iPad (Safari)

#### 测试要点
- 响应式布局
- 触摸友好的按钮
- 数字键盘自动弹出
- 支付方式网格布局

### 10. 完整结账流程测试

#### 步骤
1. 添加多个商品到购物车
2. 应用优惠券（如果有）
3. 填写收货地址
4. 选择支付方式
5. 填写支付信息
6. 提交订单

#### 验证点
- ✅ 订单总额正确计算
- ✅ 折扣正确应用
- ✅ 运费正确计算
- ✅ 税费正确计算
- ✅ 支付方式保存到订单
- ✅ 订单创建成功
- ✅ 购物车清空
- ✅ 跳转到成功页面

## 数据持久化测试

### localStorage 测试

#### 测试步骤
1. 保存一张卡片
2. 刷新页面
3. 返回结账页面

#### 预期结果
- ✅ 保存的卡片仍然存在
- ✅ 默认卡片状态保持

### 清除数据测试

#### 测试步骤
1. 打开浏览器开发者工具
2. Application > Local Storage
3. 找到 `astro_saved_cards`
4. 删除该项
5. 刷新页面

#### 预期结果
- ✅ 保存的卡片消失
- ✅ 显示新卡片表单

## 安全测试

### CVV 不保存测试

#### 验证
1. 保存一张卡片
2. 检查 localStorage 中的 `astro_saved_cards`
3. 确认没有 CVV 字段

#### 预期结果
- ✅ 只保存后4位卡号
- ✅ 不保存完整卡号
- ✅ 不保存 CVV
- ✅ 保存过期日期和品牌

## 性能测试

### 加载时间
- 支付组件应该快速加载
- 表单输入应该响应迅速
- 验证应该实时进行

### 内存使用
- 检查是否有内存泄漏
- 多次支付后检查内存使用

## 浏览器兼容性测试

### 测试浏览器
- ✅ Chrome (最新版)
- ✅ Firefox (最新版)
- ✅ Safari (最新版)
- ✅ Edge (最新版)

### 测试功能
- 卡号格式化
- 日期格式化
- 表单验证
- 支付处理
- 数据持久化

## 已知限制

### 当前版本（模拟支付）
- ❌ 不进行真实支付处理
- ❌ 不连接真实支付网关
- ❌ 不进行 Luhn 算法验证
- ❌ 不进行 3D Secure 验证
- ❌ 5%随机失败用于测试

### 生产环境需要
- ✅ 集成 Stripe/PayPal API
- ✅ 实现真实卡号验证
- ✅ 添加 3D Secure
- ✅ 实现 PCI DSS 合规
- ✅ 添加欺诈检测
- ✅ 实现退款功能

## 调试技巧

### 查看支付状态
```javascript
// 在浏览器控制台
const paymentStore = usePaymentStore();
console.log(paymentStore.$state);
```

### 查看保存的卡片
```javascript
// 在浏览器控制台
console.log(localStorage.getItem('astro_saved_cards'));
```

### 强制支付失败
修改 `stores/payment.ts` 中的失败概率：
```typescript
// 从 5% 改为 100%
if (Math.random() < 1.0) {
  throw new Error('Payment declined. Please try another card.');
}
```

### 跳过支付延迟
修改 `stores/payment.ts` 中的延迟时间：
```typescript
// 从 2000ms 改为 0ms
await new Promise(resolve => setTimeout(resolve, 0));
```

## 报告问题

如果发现任何问题，请记录：
1. 浏览器和版本
2. 操作步骤
3. 预期结果
4. 实际结果
5. 控制台错误信息
6. 截图（如果适用）

## 下一步

准备好后，可以集成真实支付网关：
1. Stripe - 信用卡处理
2. PayPal - PayPal 支付
3. Apple Pay - Apple 设备
4. Google Pay - Android 设备
